version: "1.0"

tasks:
  - name: Install Tools
    run: |
      go install -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
      go install -v github.com/projectdiscovery/httpx/cmd/httpx@latest
      go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
      echo "$HOME/go/bin" >> $GITHUB_PATH

  - name: Prepare Directories
    run: mkdir -p out_scan reports

  - name: Run Subfinder
    run: subfinder -d ziana-scan.bensalemyassine498.workers.dev -silent -o out_scan/subs.txt || true

  - name: Run Httpx
    run: httpx -l out_scan/subs.txt -silent -o out_scan/live.txt || true

  - name: Run Nuclei
    run: nuclei -l out_scan/live.txt -severity medium,high,critical -jsonl -o out_scan/report.jsonl || true

  - name: Generate TSV Report
    run: |
      if [ -s out_scan/report.jsonl ]; then
        jq -r '[.matched-at, .info.name, .info.severity] | @tsv' out_scan/report.jsonl > reports/report.tsv
      else
        echo -e "No findings\t-\t-" > reports/report.tsv
      fi
